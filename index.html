<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frontline: Scorched Earth</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .header { height: 50px; background: rgba(0,0,0,0.8); display: flex; justify-content: space-around; align-items: center; font-size: 14px; border-bottom: 2px solid #333; }
        canvas { flex-grow: 1; background: #355e3b; display: block; touch-action: none; }
        .controls { height: 100px; background: #111; display: flex; justify-content: center; gap: 20px; align-items: center; }
        .btn { width: 80px; height: 70px; background: #2c2c2c; border: 2px solid #555; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .btn:active { transform: scale(0.95); background: #444; }
        .cost { font-size: 10px; color: #ffcc00; }
        .label { font-size: 11px; font-weight: bold; }
        .icon { width: 15px; height: 15px; border: 2px solid white; }
        .circle { border-radius: 50%; }
    </style>
</head>
<body>

    <div class="header">
        <div>РЕСУРСЫ: <b id="scrap">100</b></div>
        <div>СТАТУС: <b id="status">БОЙ</b></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="btn" onclick="spawn('infantry')">
            <div class="icon circle" style="background: #00d4ff;"></div>
            <div class="label">ПЕХОТА</div>
            <div class="cost">10</div>
        </div>
        <div class="btn" onclick="spawn('tank')">
            <div class="icon" style="background: #00d4ff;"></div>
            <div class="label">ТАНК</div>
            <div class="cost">40</div>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 150;
    }
    window.onresize = resize;
    resize();

    let scrap = 100;
    let units = [];
    
    // Создаем узлы линии фронта (много точек для изгибов)
    const segmentCount = 15; 
    let frontlinePoints = [];
    for(let i = 0; i <= segmentCount; i++) {
        frontlinePoints.push(canvas.height / 2); // Изначально ровная линия посередине
    }

    class Unit {
        constructor(side, type) {
            this.side = side;
            this.type = type;
            this.x = Math.random() * (canvas.width - 40) + 20;
            this.y = side === 'player' ? canvas.height : 0;
            
            if (type === 'infantry') {
                this.speed = side === 'player' ? -0.8 : 0.8; // Медленнее для "дистанции"
                this.power = 3; 
                this.size = 6;
            } else {
                this.speed = side === 'player' ? -0.4 : 0.4;
                this.power = 15; 
                this.size = 14;
            }
        }

        update() {
            this.y += this.speed;
            
            // Определяем, над каким сегментом фронта находится юнит
            let segmentIndex = Math.floor((this.x / canvas.width) * segmentCount);
            let currentFrontY = frontlinePoints[segmentIndex];

            // Проверка столкновения с фронтом
            if (this.side === 'player' && this.y <= currentFrontY) {
                frontlinePoints[segmentIndex] -= this.power; // Толкаем вверх
                return true; // Юнит "отработал"
            } 
            if (this.side === 'enemy' && this.y >= currentFrontY) {
                frontlinePoints[segmentIndex] += this.power; // Толкаем вниз
                return true;
            }
            return false;
        }

        draw() {
            ctx.fillStyle = this.side === 'player' ? '#00d4ff' : '#ff4d4d';
            ctx.shadowBlur = 5;
            ctx.shadowColor = ctx.fillStyle;
            
            if (this.type === 'infantry') {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
            } else {
                ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
            }
            ctx.shadowBlur = 0;
        }
    }

    function spawn(type) {
        let cost = type === 'infantry' ? 10 : 40;
        if (scrap >= cost) {
            scrap -= cost;
            units.push(new Unit('player', type));
            document.getElementById('scrap').innerText = Math.floor(scrap);
        }
    }

    // Вражеский ИИ
    setInterval(() => {
        let type = Math.random() > 0.2 ? 'infantry' : 'tank';
        units.push(new Unit('enemy', type));
    }, 2000);

    function drawFrontline() {
        ctx.beginPath();
        ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
        ctx.lineWidth = 4;
        ctx.lineJoin = "round";

        // Рисуем сглаженную кривую по точкам
        ctx.moveTo(0, frontlinePoints[0]);
        for(let i = 0; i < frontlinePoints.length - 1; i++) {
            let xc = (i * (canvas.width / segmentCount) + (i + 1) * (canvas.width / segmentCount)) / 2;
            let yc = (frontlinePoints[i] + frontlinePoints[i+1]) / 2;
            ctx.quadraticCurveTo(i * (canvas.width / segmentCount), frontlinePoints[i], xc, yc);
        }
        ctx.stroke();

        // Заливка территорий цветом
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fillStyle = "rgba(0, 212, 255, 0.1)"; // Твоя зона
        ctx.fill();
    }

    function gameLoop() {
        ctx.fillStyle = '#2d4c2d'; // Цвет земли
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        drawFrontline();

        for (let i = units.length - 1; i >= 0; i--) {
            if (units[i].update()) {
                units.splice(i, 1);
            } else {
                units[i].draw();
            }
        }

        scrap += 0.03;
        document.getElementById('scrap').innerText = Math.floor(scrap);
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
</body>
</html>
