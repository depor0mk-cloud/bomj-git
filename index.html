<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frontline: Invasion</title>
    <style>
        body { margin: 0; background: #4ec41b; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
        .ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; pointer-events: none; }
        canvas { display: block; }
        .cheat-panel { position: absolute; bottom: 10px; right: 10px; display: flex; flex-direction: column; gap: 5px; }
        .btn { padding: 10px; background: #222; color: #0f0; border: 1px solid #0f0; cursor: pointer; font-size: 12px; }
        .win-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: gold; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
    </style>
</head>
<body>

    <div class="ui">
        Производство: <span id="prodStatus">АКТИВНО</span><br>
        Юнитов в бою: <span id="unitCount">0</span>
    </div>

    <div class="cheat-panel">
        <button class="btn" onclick="spawn('tank', 'player')">+ ТАНК (ЧИТ)</button>
        <button class="btn" onclick="spawn('infantry', 'enemy')">+ ВРАГ (ЧИТ)</button>
        <button class="btn" onclick="frontline.fill(canvas.height/2)">СБРОС ФРОНТА</button>
    </div>

    <div id="winScreen" class="win-screen">
        <h1 id="winText">ПОБЕДА!</h1>
        <button onclick="location.reload()">ИГРАТЬ СНОВА</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.onresize = resize;
    resize();

    const lineRes = 25;
    let frontline = Array(lineRes + 1).fill(canvas.height / 2);
    let units = [];
    let helicopters = [];

    class Unit {
        constructor(side, type, x, y) {
            this.side = side;
            this.type = type;
            this.x = x || canvas.width / 2;
            this.y = y || (side === 'player' ? canvas.height - 60 : 60);
            this.hp = type === 'infantry' ? 40 : 180;
            this.speed = type === 'infantry' ? 1.2 : 0.6;
            this.power = type === 'infantry' ? 0.2 : 0.6;
            this.targetX = Math.random() * canvas.width;
        }

        update() {
            let seg = Math.floor((this.x / canvas.width) * lineRes);
            seg = Math.max(0, Math.min(lineRes, seg));
            let lineY = frontline[seg];

            // Проверка победы (если фронт дошел до столицы)
            if (frontline[seg] < 60) endGame("ИГРОК ПОБЕДИЛ!");
            if (frontline[seg] > canvas.height - 60) endGame("ВРАГ ПОБЕДИЛ!");

            let enemies = units.filter(u => u.side !== this.side && Math.hypot(u.x - this.x, u.y - this.y) < 40);
            
            if (enemies.length > 0) {
                enemies[0].hp -= 1;
                this.hp -= 0.5;
            } else {
                let distY = Math.abs(this.y - lineY);
                if (distY > 10) {
                    this.y += (this.side === 'player' ? -1 : 1) * this.speed;
                    this.x += (this.targetX - this.x) * 0.01;
                } else {
                    frontline[seg] += (this.side === 'player' ? -this.power : this.power);
                    this.y = frontline[seg] + (this.side === 'player' ? 5 : -5);
                }
            }
            return this.hp <= 0;
        }

        draw() {
            ctx.fillStyle = this.side === 'player' ? '#0055ff' : '#ff0000';
            ctx.beginPath();
            if(this.type === 'infantry') ctx.arc(this.x, this.y, 6, 0, Math.PI*2);
            else ctx.fillRect(this.x-10, this.y-5, 20, 10);
            ctx.fill();
            ctx.strokeStyle = 'black'; ctx.stroke();
        }
    }

    class Helicopter {
        constructor(side) {
            this.side = side;
            this.x = side === 'player' ? -50 : canvas.width + 50;
            this.y = Math.random() * (canvas.height * 0.4) + (side === 'player' ? canvas.height*0.5 : 100);
            this.targetX = canvas.width / 2 + (Math.random()*200 - 100);
            this.hasDropped = false;
        }

        update() {
            this.x += (this.side === 'player' ? 3 : -3);
            // Высадка десанта в центре карты
            if (!this.hasDropped && Math.abs(this.x - this.targetX) < 10) {
                let count = Math.floor(Math.random() * 3) + 1;
                for(let i=0; i<count; i++) {
                    units.push(new Unit(this.side, 'infantry', this.x + (i*15), this.y));
                }
                this.hasDropped = true;
            }
            return (this.x > canvas.width + 100 || this.x < -100);
        }

        draw() {
            ctx.fillStyle = '#333';
            ctx.fillRect(this.x - 20, this.y - 5, 40, 10); // Корпус
            ctx.fillRect(this.x - 25, this.y - 12, 50, 2); // Лопасти
        }
    }

    function spawn(type, side) {
        units.push(new Unit(side, type));
    }

    function endGame(text) {
        document.getElementById('winScreen').style.display = 'flex';
        document.getElementById('winText').innerText = text;
    }

    // Авто-производство (2-5 сек)
    function startFactories() {
        setInterval(() => spawn(Math.random() > 0.8 ? 'tank' : 'infantry', 'player'), 3000);
        setInterval(() => spawn(Math.random() > 0.8 ? 'tank' : 'infantry', 'enemy'), 3500);
        // Вертолеты (раз в 10 сек)
        setInterval(() => helicopters.push(new Helicopter('player')), 10000);
        setInterval(() => helicopters.push(new Helicopter('enemy')), 12000);
    }

    function gameLoop() {
        ctx.fillStyle = '#4ec41b';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Столицы (Звезды/Круги)
        ctx.fillStyle = '#ffff00';
        ctx.beginPath();
        ctx.arc(canvas.width / 2, 40, 30, 0, Math.PI*2); // Враг
        ctx.arc(canvas.width / 2, canvas.height - 40, 30, 0, Math.PI*2); // Игрок
        ctx.fill();

        // Фронт
        ctx.strokeStyle = 'black'; ctx.lineWidth = 4; ctx.beginPath();
        ctx.moveTo(0, frontline[0]);
        for(let i=1; i<=lineRes; i++) ctx.lineTo(i*(canvas.width/lineRes), frontline[i]);
        ctx.stroke();

        units = units.filter(u => { let d = u.update(); u.draw(); return !d; });
        helicopters = helicopters.filter(h => { let off = h.update(); h.draw(); return !off; });

        document.getElementById('unitCount').innerText = units.length;
        requestAnimationFrame(gameLoop);
    }

    startFactories();
    gameLoop();
</script>
</body>
</html>
